{% extends 'admin/base.html.twig' %}

{% block title %}{{ projet ? 'Modifier' : 'Créer' }} un projet{% endblock %}

{% block admin_body %}
  <div class="min-h-screen bg-gradient-to-br from-gray-50 to-green-50/30 p-6">
    <div class="max-w-4xl mx-auto">
      {# Header #}
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
        <div class="space-y-2">
          <h1 class="text-3xl font-bold bg-gradient-to-r from-green-600 to-orange-500 bg-clip-text text-transparent">
            {{ projet ? 'Modifier' : 'Créer' }} un projet
          </h1>
          <p class="text-gray-600 text-lg">Gérez les projets pour vos événements</p>
        </div>
        <a href="{{ path('admin_projets_index') }}" class="group inline-flex items-center gap-3 px-6 py-3 rounded-xl font-semibold transition-all duration-300 bg-white text-gray-700 border border-gray-200 shadow-sm hover:shadow-md hover:border-green-400 hover:scale-105">
          <i class="fas fa-arrow-left text-green-500 group-hover:-translate-x-1 transition-transform"></i>
          <span>Retour à la liste</span>
        </a>
      </div>

      {# Form Card #}
      <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
        {{ form_start(form, {'attr': {'class': 'p-0'}}) }}
        
        {# Informations générales #}
        <div class="p-8 border-b border-gray-100">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-orange-400 rounded-xl flex items-center justify-center">
              <i class="fas fa-lightbulb text-white text-lg"></i>
            </div>
            <div>
              <h2 class="text-xl font-semibold text-gray-900">Informations du projet</h2>
              <p class="text-gray-500 text-sm">Définissez les détails principaux de votre projet</p>
            </div>
          </div>
          
          <div class="space-y-6">
            {# Nom du projet #}
            <div class="space-y-2">
              <label class="block text-sm font-semibold text-gray-700">
                Nom du projet <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                {{ form_widget(form.nom, {'attr': {
                  'class': 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 placeholder-gray-400',
                  'placeholder': 'Ex: Festival Culturel Bénin-Nigeria'
                }}) }}
                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                  <i class="fas fa-tag text-gray-400"></i>
                </div>
              </div>
              {% if form_errors(form.nom) %}
                <div class="text-red-500 text-sm flex items-center gap-2 mt-1">
                  <i class="fas fa-exclamation-circle"></i>
                  {{ form_errors(form.nom) }}
                </div>
              {% endif %}
            </div>
            
            {# Description #}
            <div class="space-y-2">
              <label class="block text-sm font-semibold text-gray-700">
                Description du projet
              </label>
              {{ form_widget(form.description, {'attr': {
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 placeholder-gray-400 min-h-[120px] resize-vertical',
                'placeholder': 'Décrivez votre projet en détail...',
                'rows': 4
              }}) }}
              {% if form_errors(form.description) %}
                <div class="text-red-500 text-sm flex items-center gap-2 mt-1">
                  <i class="fas fa-exclamation-circle"></i>
                  {{ form_errors(form.description) }}
                </div>
              {% endif %}
            </div>

            {# Image du projet #}
            <div class="space-y-4">
              <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700">
                  Image du projet
                </label>
                
                {# Image actuelle #}
                {% if projet and projet.logos %}
                  <div class="mb-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
                    <p class="text-sm font-medium text-gray-700 mb-3">Image actuelle :</p>
                    <div class="flex items-center gap-4">
                      <div class="relative group">
                        <img src="{{ path('secure_upload', {'filename': projet.image}) }}" 
                             alt="Image du projet" 
                             class="w-48 h-32 object-cover rounded-lg border-2 border-gray-300 shadow-sm group-hover:shadow-md transition-shadow">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-lg transition-all duration-300 flex items-center justify-center">
                          <button type="button" 
                                  class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 transition-all duration-300 transform scale-90 group-hover:scale-100"
                                  onclick="removeCurrentImage()">
                            <i class="fas fa-trash text-xs"></i>
                          </button>
                        </div>
                      </div>
                      <div class="text-sm text-gray-600">
                        <p class="font-medium">Cliquez sur l'image pour la supprimer</p>
                        <p class="text-xs mt-1">Une nouvelle image la remplacera</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {# Upload zone #}
                <div class="relative">
                  <div class="flex items-center justify-center w-full">
                    <label for="{{ form.logos.vars.id }}" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer bg-gray-50 hover:bg-gray-100 transition-all duration-300 group">
                      <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <i class="fas fa-cloud-upload-alt text-2xl text-gray-400 group-hover:text-green-500 mb-2 transition-colors"></i>
                        <p class="text-sm text-gray-500 group-hover:text-gray-700">
                          <span class="font-semibold">Cliquez pour uploader</span> ou glissez-déposez
                        </p>
                        <p class="text-xs text-gray-400 mt-1">PNG, JPG, GIF jusqu'à 5MB</p>
                      </div>
                      {{ form_widget(form.logos, {'attr': {
                        'class': 'hidden',
                        'onchange': 'previewImage(this)'
                      }}) }}
                    </label>
                  </div>
                  
                  {# Aperçu de la nouvelle image #}
                  <div id="image-preview" class="mt-4 hidden">
                    <p class="text-sm font-medium text-gray-700 mb-2">Aperçu de la nouvelle image :</p>
                    <div class="relative inline-block">
                      <img id="preview-img" src="" alt="Aperçu" class="w-48 h-32 object-cover rounded-lg border-2 border-green-500 shadow-md">
                      <button type="button" 
                              class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition-all duration-300"
                              onclick="clearImagePreview()">
                        <i class="fas fa-times text-xs"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {# Actions #}
        <div class="p-8 bg-gray-50/50">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div class="flex items-center gap-2 text-sm text-gray-500">
              <i class="fas fa-info-circle text-green-500"></i>
              <span>Les champs marqués d'un <span class="text-red-500">*</span> sont obligatoires</span>
            </div>
            <div class="flex items-center gap-3">
              <a href="{{ path('admin_projets_index') }}" 
                 class="group inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 bg-white text-gray-700 border border-gray-300 shadow-sm hover:shadow-md hover:border-red-400 hover:scale-105">
                <i class="fas fa-times text-red-500 group-hover:scale-110 transition-transform"></i>
                <span>Annuler</span>
              </a>
              <button type="submit" 
                      class="group inline-flex items-center gap-3 px-8 py-3 rounded-xl font-semibold transition-all duration-300 bg-gradient-to-r from-green-600 to-orange-500 text-white shadow-lg hover:shadow-xl hover:scale-105 transform">
                <i class="fas fa-{{ projet ? 'save' : 'plus' }} group-hover:scale-110 transition-transform"></i>
                <span>{{ projet ? 'Modifier' : 'Créer' }} le projet</span>
                <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
              </button>
            </div>
          </div>
        </div>
        {{ form_end(form) }}
      </div>
    </div>
  </div>

  <script>
    function previewImage(input) {
      const preview = document.getElementById('image-preview');
      const previewImg = document.getElementById('preview-img');

      if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function(e) {
          previewImg.src = e.target.result;
          preview.classList.remove('hidden');
        };

        reader.readAsDataURL(input.files[0]);
      } else {
        preview.classList.add('hidden');
      }
    }

    function clearImagePreview() {
      const input = document.getElementById('{{ form.logos.vars.id }}');
      const preview = document.getElementById('image-preview');
      
      input.value = '';
      preview.classList.add('hidden');
    }

    function removeCurrentImage() {
      if (confirm('Êtes-vous sûr de vouloir supprimer l\'image actuelle ?')) {
        // Create a hidden input to indicate image removal
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'remove_image';
        input.value = '1';
        document.querySelector('form').appendChild(input);

        // Hide the current image section
        const currentImageSection = event.target.closest('.bg-gray-50');
        if (currentImageSection) {
          currentImageSection.style.display = 'none';
        }
      }
    }

    // Drag and drop functionality
    document.addEventListener('DOMContentLoaded', function() {
      const dropZone = document.querySelector('label[for="{{ form.logos.vars.id }}"]');
      const fileInput = document.getElementById('{{ form.logos.vars.id }}');

      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
      });

      ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
      });

      function highlight() {
        dropZone.classList.add('border-green-500', 'bg-green-50');
      }

      function unhighlight() {
        dropZone.classList.remove('border-green-500', 'bg-green-50');
      }

      dropZone.addEventListener('drop', handleDrop, false);

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files;
        previewImage(fileInput);
      }
    });
  </script>

  <style>
    .min-h-\[120px\] {
      min-height: 120px;
    }
    
    /* Custom scrollbar for textarea */
    textarea::-webkit-scrollbar {
      width: 6px;
    }
    
    textarea::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    
    textarea::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    textarea::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
  </style>
{% endblock %}